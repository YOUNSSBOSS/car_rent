<%# Remove layout specific tags if layout is handled by express-ejs-layouts via controller %>

<h1>Add New Car</h1>

<% if (locals.error_msg && error_msg.length > 0) { %>
    <div style="color: red; border: 1px solid red; padding: 10px; margin-bottom: 10px;">
        <strong>Please correct the following errors:</strong><br>
        <%- error_msg %> <% /* Use <%- to render HTML from flash messages if they contain <br> */ %>
    </div>
<% } %>
<% if (locals.success_msg && success_msg.length > 0) { %>
    <p style="color: green;"><%= success_msg %></p>
<% } %>

<form action="/admin/cars/add" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <div>
        <label for="make">Make:</label>
        <input type="text" id="make" name="make" value="<%= typeof car !== 'undefined' && car.make ? car.make : '' %>" required>
    </div>
    <div>
        <label for="model">Model:</label>
        <input type="text" id="model" name="model" value="<%= typeof car !== 'undefined' && car.model ? car.model : '' %>" required>
    </div>
    <div>
        <label for="year">Year:</label>
        <input type="number" id="year" name="year" value="<%= typeof car !== 'undefined' && car.year ? car.year : '' %>" required>
    </div>
    <div>
        <label for="pricePerDay">Price Per Day:</label>
        <input type="number" id="pricePerDay" name="pricePerDay" step="0.01" value="<%= typeof car !== 'undefined' && car.pricePerDay ? car.pricePerDay : '' %>" required>
    </div>
    <div>
        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="available" <%= (typeof car !== 'undefined' && car.status === 'available') ? 'selected' : '' %>>Available</option>
            <option value="booked" <%= (typeof car !== 'undefined' && car.status === 'booked') ? 'selected' : '' %>>Booked</option>
            <option value="maintenance" <%= (typeof car !== 'undefined' && car.status === 'maintenance') ? 'selected' : '' %>>Maintenance</option>
        </select>
    </div>
    <div>
        <label for="features">Features (comma-separated):</label>
        <input type="text" id="features" name="features" value="<%= typeof car !== 'undefined' && car.features ? (Array.isArray(car.features) ? car.features.join(', ') : car.features) : '' %>">
    </div>
    <div>
        <label for="carImage">Car Image:</label>
        <input type="file" id="carImage" name="carImage">
        <% if (typeof car !== 'undefined' && car.imageURL) { %>
            <p>Current image: <img src="<%= car.imageURL %>" alt="Current car image" width="100"></p>
        <% } %>
    </div>
    <button type="submit">Add Car</button>
</form>
<a href="/admin/cars">Back to Car List</a>
